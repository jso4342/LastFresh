<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>라스트프레시 | 상품상세페이지</title>
    <link rel="stylesheet" href="/front/assets/css/product/productDetail.css">
    <link rel="stylesheet" href="/front/assets/css/fragments.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@100;300;400;500;700;900&family=Noto+Sans:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">
</head>
<style>
    *{font-family: 'Noto Sans KR', sans-serif !important;}
</style>
<body class="goods-goods_view">
<th:block th:insert="fragments/headerWithout.html :: headWithoutFragment"/>
<div id="wrap">
    <div id="pos_scroll"></div>
    <div id="container">
        <div id="main">
            <div id="content" style="opacity: 1;">
                <div class="section_view">
                    <div id="shareLayer">
                        <div class="layer_share">
                            <div class="inner_layersns">
                                <h3 class="screen_out">SNS 공유하기</h3>
                                <ul class="list_share">
                                    <li>
                                        <a class="btn btn_fb" data-sns-name="페이스북" data-sns="facebook" href="https://www.kurly.com/shop/goods/goods_view.php?&goodsno=122963#none">
                                            <img src="https://res.kurly.com/mobile/service/goodsview/1804/ico_facebook.png" alt="페이스북">
                                            <span class="txt">공유하기</span>
                                        </a>
                                    </li>
                                    <li>
                                        <a class="btn btn_tw" data-sns-name="트위터" data-sns="twitter" href="https://www.kurly.com/shop/goods/goods_view.php?&goodsno=122963#none">
                                            <img src="https://res.kurly.com/mobile/service/goodsview/1804/ico_twitter.png" alt="트위터">
                                            <span class="txt">트윗하기</span>
                                        </a>
                                    </li>
                                    <li class="btn_url">
                                        <input type="text" class="inp" value readonly="readonly">
                                        <a class="btn_copy off" data-sns-name="링크 복사" data-sns="copy" href="https://www.kurly.com/shop/goods/goods_view.php?&goodsno=122963#none">
                                            "URL 복사"
                                            <img src="https://res.kurly.com/mobile/service/goodsview/1804/ico_checked_x2.png">
                                        </a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div id="sectionView" th:object="${proDetail}">
                        <div class="inner_view">
                            <div class="thumb">
                                <img th:src="'/sell/display?fileName=' + *{sellProductImageUploadPath} + '/' + *{sellProductThumbnail}" style="width:100%">
                            </div>
                            <input type="hidden" th:value="*{sellProductNum}">
                            <p class="goods_name">
                                <strong class="name" th:text="*{sellProductName}"></strong>
                                <span class="short_desc" th:text="*{sellProductDescription}"></span>
                            </p>
                            <!---->
                            <p class="goods_price">
                                    <span class="position">
                                        <span class="dc">
                                            <span class="dc_price"
                                                  th:text="|${#numbers.formatInteger(proDetail.sellProductDiscountPrice, 0, 'COMMA')}원|">
                                                "15,900"
                                                <span class="won">원</span>
                                            </span>
                                        </span>
                                        <!---->
                                        <!---->
                                    </span>
                                <!---->
                                <span>
                                </span>
                                <!---->
                                <!---->
                                <!---->
                            </p>
                            <!---->
                            <!---->
                            <!---->
                            <div class="goods_info">
                                <!---->
                                <dl class="list fst">
                                    <dt class="tit">매장</dt>
                                    <dd class="desc" th:text="*{userName}"></dd>
                                </dl>
                                <dl class="list"
                                    th:style="*{sellProductDeliveryMethod == '0' ? 'display:none;' : 'display:inline-block;'}">
                                    <dt class="tit">배달 가능 지역</dt>
                                    <dd class="desc" th:text="*{sellProductDeliveryAddress1}"></dd>
                                    <dt class="tit"></dt>
                                    <dd class="desc desc223" th:text="*{sellProductDeliveryAddress2}"></dd>
                                    <dt class="tit"></dt>
                                    <dd class="desc desc223" th:text="*{sellProductDeliveryAddress3}"></dd>
                                </dl>
                                <dl class="list">
                                    <dt class="tit">매장주소</dt>
                                    <dd class="desc" th:text="*{sellProductAddress}"></dd>
                                </dl>
                                <dl class="list">
                                    <dt class="tit">배송구분</dt>
                                    <span class="receiveMethod">
									<button type="button" id="pickUpP"
                                            th:style="*{sellProductPickup == '1' ? 'display:none;' : 'display:inline-block;'}">픽업</button>
									<button type="button" id="deliveryP"
                                            th:style="*{sellProductDeliveryMethod == '0' ? 'display:none;' : 'display:inline-block;'}">배달</button>
                                    <button type="button" id="shippingP"
                                            th:style="*{sellProductShippingMethod == '0' ? 'display:none;' : 'display:inline-block;'}">배송</button>
                               </span>
                                </dl>
                            </div>
                            <!---->
                        </div>
                        <!---->
                    </div>
                    <div id="cartPut" th:object="${proDetail}">
                        <form name="form" method="get">

                            <div class="cart_option cartList cart_type2">
                                <div class="inner_option">
                                    <!---->
                                    <!---->
                                    <div class="in_option">
                                        <div class="list_goods">
                                            <!---->
                                            <!---->
                                            <!---->
                                            <ul class="list list_nopackage">
                                                <li class="on">
                                                        <span class="btn_position">
                                                            <button type="button" class="btn_del">
                                                                <span class="txt">삭제하기</span>
                                                            </button>
                                                        </span>
                                                    <span class="name">
                                                            <!---->
                                                            " [프레시지] 자이언트 살이꽉찬 동태탕 (3~4인분) "
                                                        <!---->
                                                        </span>
                                                    <span class="tit_item">구매수량</span>
                                                    <div class="option">
                                                            <span class="count">
                                                                <input th:value="*{sellProductDiscountPrice}"
                                                                       type=hidden name="sell_price">
                                                                <button type="button" class="btn down on"
                                                                        data-opt="decrease"
                                                                        onclick="del();">수량내리기</button>
                                                                <input type="text" disabled name="amount" class="inp" value="1"
                                                                       onchange="change(); ">
                                                                <button type="button" class="btn up on"
                                                                        data-opt="increase"
                                                                        onclick="add();">수량올리기</button>
                                                            </span>
                                                        <span class="price">
                                                                <!---->
                                                                <span class="dc_price">15,900원</span>
                                                            </span>
                                                    </div>
                                                </li>
                                            </ul>
                                        </div>
                                        <div id="holidayDeliveryInfo" class="holiday_delivery"></div>
                                        <!---->
                                        <div class="total">
                                            <div class="price">
                                                <!---->
                                                <strong class="tit">총 상품금액 :</strong>
                                                <input type="text" class="num" name="sum" style="width:125px" readonly disabled>
                                                <span class="won">원</span>
                                            </div>
                                            <p class="txt_point">

                                            </p>
                                        </div>
                                    </div>
                                    <form method="post" action="/product/productToBasketDetail" class="inner_option">
                                        <div class="cart_footer off">
                                            <div class="functions"></div>
                                            <div class="button_wrap">
                                                <button type="button" class="base_button full" onclick="sendBasket()">
                                                    장바구니 담기
                                                </button>
                                                <input id="basketMaxQuantity" th:value="*{sellProductStock}"
                                                       type="hidden" class="inp"/>
                                                <input id="basketQuantity"
                                                       type="hidden" class="inp"/>
                                                <input id="sellProductDiscountPrice" th:value="*{sellProductDiscountPrice}"
                                                       type=hidden />
                                                <input id="sellProductNum" th:value="*{sellProductNum}" type=hidden
                                                       name="basketPrice"/>
                                                <input id="basketDeliveryMethod" class="receiveMethodHidden"
                                                       style="display: none" type="hidden" name="basketDeliveryMethod"/>
                                            </div>
                                        </div>
                                    </form>
                                    <!---->
                                    <!---->
                                </div>
                            </div>
                            <div class="cart_option cartList cart_type1">
                                <div class="inner_option">
                                    <!---->
                                    <!---->
                                    <div class="in_option">
                                        <div class="list_goods">
                                            <div class="bar_open">
                                                <button type="button" class="btn_close">
                                                    <span class="ico open">상품 선택</span>
                                                </button>
                                            </div>
                                            <!---->
                                            <!---->
                                            <!---->
                                        </div>
                                        <!---->
                                        <!---->
                                        <!---->
                                    </div>
                                    <div class="cart_footer"></div>
                                    <!---->
                                    <!---->
                                </div>
                            </div>
                            <div class="cart_option cart_type3 notify_option"></div>
                            <div class="cart_option cart_result cart_type3"></div>
                            <form name="frmBuyNow" method="post" action="/shop/order/order.php"></form>
                            <form name="frmWishlist" method="post"></form>
                        </form>
                    </div>
                </div>
                <div class="layout-wrapper goods-view-area">
                    <div class="goods-view-infomation detail_wrap_outer" id="goods-view-infomation">
                        <div class="goods-view-tab fixed">
                            <ul class="goods-view-infomation-tab-group">
                                <li class="goods-view-infomation-tab" id="infomation">
                                    <a href="#goods-description" class="goods-view-infomation-tab-anchor __active" id="infomation_a">상품설명</a>
                                </li>
                                <li class="goods-view-infomation-tab goods-view-review-tab" id="review">
                                    <a href="#goods-qna" class="goods-view-infomation-tab-anchor"id="review_a">후기</a>
                                </li>
                            </ul>
                        </div>
                        <div class="goods-view-infomation-content __active" id="goods-description" th:object="${proDetail}">
                            <div id="giftNotice"></div>
                            <div class="goods_wrap">
                                <img th:src="'/sell/display?fileName=' + *{sellProductImageUploadPath} + '/' + *{sellProductImage}" style="width: 100%;">
                            </div>
                        </div>

                    </div>
                    <div class="goods-view-infomation-content" id="goods-qna">
                        <div id="contents-wrapper" class="goods_board">
                            <div class="xans-element- xans-product xans-product-additional detail_board  ">
                                <div class="board">
                                    <span class="line"></span>
                                    <form name="frmList">
                                        <input type="hidden" name="sort" value>
                                        <input type="hidden" name="page_num" value>
                                        <input type="hidden" name="goodsno" value="122963">
                                        <!-- <div class="title_txt">
                                             <h2>PRODUCT REVIEW</h2>
                                             <div class="sort-wrap">
                                                 <ul class="list_type1 old">
                                                     <li>
                                                         <span class="ico"></span>
                                                         <p class="txt">상품에 대한 문의를 남기는 공간입니다. 해당 게시판의 성격과 다른 글은 사전동의 없이 담당 게시판으로 이동될 수 있습니다.</p>
                                                     </li>
                                                     <li>
                                                         <span class="ico"></span>
                                                         <p class="txt">배송관련, 주문(취소/교환/환불)관련 문의 및 요청사항은 마이컬리 내</p>
                                                     </li>
                                                 </ul>
                                                 <div class="sort" style="bottom: -9px"></div>
                                             </div>
                                         </div>-->
                                        <table class="xans-board-listheader" width="100%" border="0" cellpadding="0" cellspacing="0">
                                            <caption style="display:none">구매후기 제목</caption>
                                            <colgroup>
                                                <col style="width:134px;">
                                                <col style="width:384px;">
                                                <col style="width:60px;">
                                                <col style="width:76px;">
                                                <col style="width:80px;">
                                            </colgroup>
                                            <tbody>
                                            <tr>
                                                <th scope="col" class="input_txt">제목</th>
                                                <th scope="col" class="input_txt">내용</th>
                                                <th scope="col" class="input_txt">
                                                </th>
                                                <th scope="col" class="input_txt" align="left">작성자</th>
                                                <th scope="col" class="input_txt">작성일</th>
                                            </tr>
                                            </tbody>
                                        </table>
                                        <div class="tr_line">
                                        </div>
                                        <br>
                                        <div class="board_pg_area">
                                        </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div id="layerDSR"></div>
            <div id="footer"></div>
        </div>
        <th:block th:insert="fragments/footerWithout.html :: footWithoutFragment"/>
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js"></script>
        <script src="/front/assets/js/product/proDetail.js"></script>
        <script src="/front/assets/js/product/proTime.js"></script>
        <script src="/front/assets/js/user/review.js"></script>
</body>
<script th:inline="javascript">
    let sellProductNum = [[${proDetail.sellProductNum}]];
    let page = 1;
    const $reviewUL = $("div.tr_line");

    showList(page);

    function showList(page){
        reviewService.reviewGetList({
            sellProductNum: sellProductNum, page: page || 1
        },function (reviewCount, list) {
            let str = "";
            if(list == null || list.length == 0){
                $reviewUL.html("<p>등록된 리뷰가 없습니다.</p>");
                return;
            }
 
            $.each(list, function(index, item) {
                str += "<table class='xans-board-listheaderd tbl_newtype1' width='100%' border='0' cellpadding='0' cellspacing='0' onclick='view_content'(this,'event','notice')'>";
                str += "<caption style='display:none'>구매후기 제목</caption>";
                str += "<colgroup>";
                // str += "<col style='width:140px;'>";
                str += "<col style='width:325px;'>";
                str += "<col style='width:555px;'>";
                str += "<col style='width:237px;'>";
                str += "<col style='width:184px;'>";
                str += " <col style='width:108px;'>";
                str += " </colgroup>";
                str += "<tbody>";
                str += "<tr>";
                str += "<input type='hidden' name='index' value='-1'>";
                str += "<input type='hidden' name='image' value>";
                str += "<input type='hidden' name='grade' value='0'>";
                str += "<input type='hidden' name='best' value='false'>";
                str += "<input type='hidden' name='pNo' value>";
                // str += "<td align='center'>"+ item.reviewNum+"</td>";
                str += "<td class='subject'>";
                str += "<div class='fst' style='font-weight: 800;'>"+ item.reviewTitle+ "</div>";
                str += "</td>";
                str += "<td>" + item.reviewContent + "</td>";
                str += "<td></td>";
                str += "<td class='user_grade'>" + item.userId + "</td>";
                str += "<td id='proListTime' class='time'>"
                str += reviewService.getReviewDateByJavascript(item.reviewDate)
                str += "</td>";
                str += "<tr>";
                str += "</tbody>";
                str += "</table>";
                str += "<div data-sno='53094294' class='review_view' style='display: none;'>";
                str += "<div class='inner_review'>";
                str += "<div class='name_purchase'>";
                str += "<strong class='name'>" + item.sellProductName + "</strong>";
                str += "<p class='package'></p>";
                str += "</div>";
                str += "<div>" + item.reviewContent + "</div>";
                str += "</div>";
                str += "</div>";
                str += "</div>";
                str += "</div>";
            })
            $reviewUL.html(str);
            showReviewPage(reviewCount);
        })
    }

    // 페이징 처리
    function showReviewPage(reviewCount) {
        let endNum = Math.ceil(page / 10.0)*10;
        let startNum = endNum - 9;
        let realEnd = Math.ceil(reviewCount / 6.0);
        let str = "";
        const $pagingTag = $("div.board_pg_area");

        if (endNum > realEnd) {
            endNum = realEnd
        }

        let prev = startNum > 1;
        let next = endNum * 6 < reviewCount;

        if(matchMedia("screen and (max-width:918px)").matches){

        }else {
            if (prev) {
                str += "<a href='1' class='layout-pagination-button layout-pagination-first-page layout-pagination-number'>맨 처음 페이지로 가기</a>"
                str += "<a href='" + (startNum - 1) + "' class='layout-pagination-button layout-pagination-prev-page layout-pagination-number'>이전 페이지로 가기</a>"
            }
            for (let i=startNum; i<=endNum; i++){
                if (page == i){
                    str += "<code class='layout-pagination-button layout-pagination-number pagination-number __active'>" + i + "</code>";
                    continue;
                }
                str += "<a class='layout-pagination-button layout-pagination-number pagination-number' href='" + i + "'><code>" + i + "</code></a>";
            }
            if (next){
                str += "<a href='"+(endNum + 1)+"' class='layout-pagination-button layout-pagination-next-page layout-pagination-number'>다음 페이지로 가기</a>"
                str += "<a href='"+realEnd+"' class='layout-pagination-button layout-pagination-last-page layout-pagination-number' >맨 끝 페이지로 가기</a>"
            }
        }
        $pagingTag.html(str);
    }

    $(".board_pg_area").on("click", "a.layout-pagination-number", function (e) {
        e.preventDefault();
        $("code.layout-pagination-number").addClass("__active");
        page = $(this).attr("href");
        showList(page);
    });


    function sendBasket() {
        let sellProductDiscountPrice = $("#sellProductDiscountPrice").val();
        let sellProductNum = $("#sellProductNum").val();
        let basketDeliveryMethod = $("#basketDeliveryMethod").val();
        if(basketDeliveryMethod == "0"){
            alert("옵션을 선택해주세요")
            return false;
        }
        let userNumber = [[${userNumber}]];

        console.log("유저넘버"+userNumber);

        if(userNumber == null){
            alert("로그인 후 이용하실 수 있습니다.");
            return false;
        }else {
            alert("장바구니에 상품을 담았습니다.")
        }

        window.location.href = "/product/productToBasket?basketQuantity=" + basketQuantity+"&sellProductDiscountPrice=" + sellProductDiscountPrice +"&sellProductNum=" + sellProductNum +"&basketDeliveryMethod=" + basketDeliveryMethod;
    }
</script>
</html>